<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Instagram ‚Äì Urban Style</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --ig-blue: #0095f6;
      --ig-grey: #8e8e8e;
      --ig-light-grey: #efefef;
      --ig-white: #ffffff;
      --ig-black: #262626;
      --ig-border: #dbdbdb;
      --ig-input-bg: #f2f2f2;
      --ig-gradient: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
      --ig-msg-gradient: linear-gradient(45deg, #12c2e9, #c471ed, #f64f59);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      background: #fafafa;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      height: 100dvh;
      /* Dynamic viewport height for mobile */
      color: var(--ig-black);
      overflow: hidden;
    }

    /* Container */
    .chat-container {
      width: 100%;
      max-width: 375px;
      height: 700px;
      max-height: 100%;
      background: var(--ig-white);
      display: flex;
      flex-direction: column;
      border: 1px solid var(--ig-border);
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.04);
      position: relative;
    }

    @media (max-width: 480px) {
      body {
        align-items: flex-start;
      }

      .chat-container {
        height: 100vh;
        height: 100dvh;
        max-width: 100%;
        border: none;
        box-shadow: none;
      }
    }

    /* HEADER */
    .chat-header {
      padding: 10px 14px;
      border-bottom: 1px solid var(--ig-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 56px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .back-btn {
      cursor: pointer;
      display: flex;
      align-items: center;
    }

    .chat-header .profile-info {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
    }

    /* Story Ring Effect */
    .avatar-wrapper {
      position: relative;
      padding: 2.5px;
      background: var(--ig-gradient);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chat-header .avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 11px;
      overflow: hidden;
      padding: 1.5px;
      border: 1.5px solid #fff;
    }

    .avatar-inner {
      width: 100%;
      height: 100%;
      background: #eee;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chat-header .user-details {
      display: flex;
      flex-direction: column;
    }

    .name-wrapper {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .chat-header strong {
      font-size: 14px;
      font-weight: 600;
      line-height: 1.2;
    }

    .verified-badge {
      display: flex;
      align-items: center;
    }

    .chat-header span {
      font-size: 11px;
      color: var(--ig-grey);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .header-icon {
      cursor: pointer;
      color: #262626;
      display: flex;
      align-items: center;
      transition: opacity 0.2s;
    }

    .header-icon:active {
      opacity: 0.5;
    }

    /* MESSAGES */
    .chat-messages {
      flex: 1;
      padding: 16px 14px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 4px;
      background: #fff;
    }

    .chat-messages::-webkit-scrollbar {
      width: 0;
    }

    .message-group {
      display: flex;
      flex-direction: column;
      margin-bottom: 2px;
    }

    .message {
      max-width: 72%;
      padding: 8px 14px;
      font-size: 14px;
      line-height: 1.4;
      position: relative;
      transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.1);
    }

    .message.bot {
      background: #fff;
      border: 1px solid #efefef;
      color: var(--ig-black);
      align-self: flex-start;
      border-radius: 20px;
    }

    .message.user {
      background: var(--ig-msg-gradient);
      color: #fff;
      align-self: flex-end;
      border-radius: 20px;
    }

    /* Message tail refinement - consecutive grouping */
    .message-group+.message-group {
      margin-top: 10px;
    }

    .seen-status {
      font-size: 10px;
      color: var(--ig-grey);
      align-self: flex-end;
      margin-top: 2px;
      margin-right: 4px;
      display: none;
    }

    /* Typing Indicator */
    .typing-indicator {
      display: none;
      align-self: flex-start;
      background: #efefef;
      padding: 8px 14px;
      border-radius: 18px;
      gap: 3px;
      margin-bottom: 8px;
    }

    .dot {
      width: 5px;
      height: 5px;
      background: #8e8e8e;
      border-radius: 50%;
      animation: ig-bounce 1.3s infinite;
    }

    .dot:nth-child(2) {
      animation-delay: 0.15s;
    }

    .dot:nth-child(3) {
      animation-delay: 0.3s;
    }

    @keyframes ig-bounce {

      0%,
      60%,
      100% {
        transform: translateY(0);
      }

      30% {
        transform: translateY(-3px);
      }
    }

    /* SUGGESTIONS */
    .ig-suggestions {
      display: flex;
      gap: 6px;
      overflow-x: auto;
      padding: 10px 14px;
      border-top: 1px solid var(--ig-border);
      scrollbar-width: none;
    }

    .ig-suggestions::-webkit-scrollbar {
      display: none;
    }

    .ig-suggestions button {
      flex: 0 0 auto;
      border: 1px solid var(--ig-border);
      background: #fff;
      color: var(--ig-black);
      padding: 6px 14px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      transition: background 0.1s;
    }

    .ig-suggestions button:active {
      background: #f2f2f2;
    }

    /* FOOTER / INPUT */
    .chat-footer {
      padding: 12px 14px;
      padding-bottom: calc(12px + env(safe-area-inset-bottom, 0px));
      /* Support for modern iPhones */
      background: var(--ig-white);
    }

    .chat-input-container {
      display: flex;
      align-items: center;
      background: var(--ig-input-bg);
      border-radius: 22px;
      padding: 2px 10px;
      border: 1px solid transparent;
      transition: border-color 0.2s;
    }

    .chat-input-container:focus-within {
      background: #fff;
      border-color: #dbdbdb;
    }

    .chat-input {
      flex: 1;
      padding: 8px 6px;
      border: none;
      outline: none;
      background: transparent;
      color: var(--ig-black);
      font-size: 16px;
      /* Minimum for iOS no-zoom */
      font-family: inherit;
    }

    .input-icons {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--ig-black);
    }

    .input-icon {
      cursor: pointer;
      display: flex;
      align-items: center;
      transition: transform 0.1s;
    }

    .input-icon:active {
      transform: scale(0.9);
    }

    .send-link {
      color: var(--ig-blue);
      font-weight: 600;
      font-size: 13.5px;
      cursor: pointer;
      padding: 6px 4px;
      display: none;
      text-decoration: none;
    }
  </style>
</head>

<body>

  <div class="chat-container">
    <!-- Header -->
    <header class="chat-header">
      <div class="header-left">
        <a href="https://www.helloiagency.com" class="back-btn" style="text-decoration: none; color: inherit;">
          <svg aria-label="Volver" color="#262626" fill="#262626" height="24" role="img" viewBox="0 0 24 24" width="24">
            <line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              x1="2.909" x2="22.001" y1="12.004" y2="12.004"></line>
            <polyline fill="none" points="9.276 4.726 2.001 12.004 9.276 19.274" stroke="currentColor"
              stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></polyline>
          </svg>
        </a>
        <div class="profile-info">
          <div class="avatar-wrapper">
            <div class="avatar" id="headerAvatar">
              <div class="avatar-inner">US</div>
            </div>
          </div>
          <div class="user-details">
            <div class="name-wrapper">
              <strong>Urban Style</strong>
              <div class="verified-badge">
                <svg aria-label="Verificado" color="#0095f6" fill="#0095f6" height="12" role="img" viewBox="0 0 40 40"
                  width="12">
                  <path
                    d="M19.998 3.094c-2.51 0-4.92 1.117-6.503 3.01a1.001 1.001 0 0 1-1.183.256c-2.855-1.123-6.431.189-7.142 3.109-.122.503-.484.911-.965 1.082-2.855 1.012-4.023 4.264-2.336 6.5a1.001 1.001 0 0 1 .132 1.205c-1.618 2.605-1.028 6.124 1.319 8.01a1.002 1.002 0 0 1 .35 1.157c-1.137 2.85 1.15 6.345 4.07 6.345.52 0 1.01.272 1.286.713 1.55 2.474 4.88 3.193 7.373 1.62a1 1 0 0 1 1.173.06c2.408 1.83 5.922 1.83 8.33 0a1 1 0 0 1 1.173-.06c2.493 1.573 5.823.854 7.373-1.62.276-.441.766-.713 1.286-.713 2.92 0 5.207-3.495 4.07-6.345a1.002 1.002 0 0 1 .35-1.157c2.347-1.886 2.937-5.405 1.319-8.01a1.001 1.001 0 0 1 .132-1.205c1.687-2.236.519-5.488-2.336-6.5a1.001 1.001 0 0 1-.965-1.082c-.711-2.92-4.287-4.232-7.142-3.109a1.001 1.001 0 0 1-1.183-.256c-1.583-1.893-3.993-3.01-6.503-3.01zm6.298 12.094l-9 9a1 1 0 0 1-1.414 0l-5-5a1 1 0 1 1 1.414-1.414l4.293 4.293 8.293-8.293a1 1 0 1 1 1.414 1.414z"
                    fill-rule="evenodd"></path>
                </svg>
              </div>
            </div>
            <span>Activo(a) ahora</span>
          </div>
        </div>
      </div>
      <div class="header-right">
        <div class="header-icon">
          <svg aria-label="Llamada de voz" color="#262626" fill="#262626" height="22" role="img" viewBox="0 0 24 24"
            width="22">
            <path
              d="M18.227 23.385c-3.15 0-7.252-1.39-11.103-5.241C3.272 14.292 1.882 10.191 1.882 7.04c0-2.31 1.258-4.321 3.542-5.663a1.956 1.956 0 0 1 2.279.31l2.451 2.451a1.948 1.948 0 0 1 .494 1.838l-.689 2.76a1.941 1.941 0 0 1-.958 1.282l-1.071.588a.333.333 0 0 0-.154.404c.484 1.257 1.488 2.87 2.923 4.305s3.048 2.439 4.305 2.922a.333.333 0 0 0 .404-.153l.588-1.071a1.94 1.94 0 0 1 1.282-.958l2.76-.689a1.95 1.95 0 0 1 1.838.494l2.451 2.451a1.956 1.956 0 0 1 .31 2.279c-1.343 2.284-3.354 3.542-5.664 3.542zM7.04 3.1c-1.253 0-2.228.783-3.044 1.832-.82 1.053-.9 2.115-.843 2.37.054 1.34 1.433 5.483 5.378 9.428 3.945 3.945 8.089 5.324 9.428 5.378.256.057 1.317-.024 2.37-.843 1.049-.816 1.832-1.791 1.832-3.044l-2.451-2.451-2.479.62-.777 1.415c-.689 1.254-2.217 1.57-3.692.935-1.573-.675-3.418-2.253-5.111-3.947-1.694-1.693-3.272-3.538-3.947-5.111-.635-1.474-.319-3.002.936-3.692l1.415-.777.62-2.479-2.45-2.45z"
              fill-rule="evenodd"></path>
          </svg>
        </div>
        <div class="header-icon">
          <svg aria-label="Videochat" color="#262626" fill="#262626" height="22" role="img" viewBox="0 0 24 24"
            width="22">
            <rect fill="none" height="12" rx="2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
              stroke-width="2" width="14" x="2" y="6"></rect>
            <path d="M16 8.991l3.522-2.818A2 2 0 0 1 22 7.71v8.58a2 2 0 0 1-2.478 1.537L16 15.009" fill="none"
              stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
          </svg>
        </div>
        <div class="header-icon">
          <svg aria-label="Informaci√≥n de la conversaci√≥n" color="#262626" fill="#262626" height="22" role="img"
            viewBox="0 0 24 24" width="22">
            <circle cx="12.001" cy="12.005" fill="none" r="10.5" stroke="currentColor" stroke-linecap="round"
              stroke-linejoin="round" stroke-width="2"></circle>
            <circle cx="11.819" cy="7.709" r="1.25"></circle>
            <line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              x1="10.569" x2="13.432" y1="16.777" y2="16.777"></line>
            <polyline fill="none" points="10.569 11.05 12.001 11.05 12.001 16.777" stroke="currentColor"
              stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></polyline>
          </svg>
        </div>
      </div>
    </header>

    <!-- Messages -->
    <div class="chat-messages" id="chatMessages"></div>

    <!-- Typing Indicator -->
    <div class="typing-indicator" id="typingIndicator">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>

    <!-- Suggestions -->
    <div class="ig-suggestions" id="igSuggestions">
      <button data-text="¬øQu√© horarios tienen?">üïí ¬øQu√© horarios tienen?</button>
      <button data-text="¬øD√≥nde est√°n ubicados?">üìç ¬øD√≥nde est√°n ubicados?</button>
      <button data-text="¬øHacen env√≠os?">üöö ¬øHacen env√≠os?</button>
    </div>

    <!-- Footer -->
    <div class="chat-footer">
      <form class="chat-input-container" id="chatForm">
        <div class="input-icons">
          <div class="input-icon">
            <svg aria-label="Elegir un emoji" color="#262626" fill="#262626" height="22" role="img" viewBox="0 0 24 24"
              width="22">
              <path
                d="M15.83 10.997a1.167 1.167 0 1 0 1.167 1.167 1.167 1.167 0 0 0-1.167-1.167zm-7.66 0a1.167 1.167 0 1 0 1.166 1.167 1.167 1.167 0 0 0-1.166-1.167zm3.83 6.133a5.21 5.21 0 0 1-4.008-1.896.791.791 0 0 1 .12-1.111.78.78 0 0 1 1.099.122 3.619 3.619 0 0 0 5.58 0 .78.78 0 0 1 1.1.12.791.791 0 0 1 .118 1.113 5.209 5.209 0 0 1-4.009 1.898l-.001-.044zm0-14.731a10.395 10.395 0 1 0 10.394 10.395A10.407 10.407 0 0 0 12 2.399zm0 18.291a7.896 7.896 0 1 1 7.896-7.896A7.905 7.905 0 0 1 12 20.69z">
              </path>
            </svg>
          </div>
        </div>
        <input class="chat-input" id="chatInput" placeholder="Enviar mensaje‚Ä¶" autocomplete="off" />
        <div class="input-icons">
          <div id="extraIcons" style="display: flex; gap: 10px;">
            <div class="input-icon">
              <svg aria-label="Micr√≥fono" color="#262626" fill="#262626" height="22" role="img" viewBox="0 0 24 24"
                width="22">
                <path
                  d="M12 16.5a4.52 4.52 0 0 1-4.5-4.5V6a4.5 4.5 0 0 1 9 0v6a4.512 4.512 0 0 1-4.5 4.5zm0-13.5A3.003 3.003 0 0 0 9 6v6a3 3 0 0 0 6 0V6a3 3 0 0 0-3-3z">
                </path>
                <path d="M19.5 12h-1.5a6 6 0 0 1-12 0H4.5a7.5 7.5 0 0 0 15 0z"></path>
              </svg>
            </div>
            <div class="input-icon">
              <svg aria-label="Imagen" color="#262626" fill="#262626" height="22" role="img" viewBox="0 0 24 24"
                width="22">
                <path d="M22 6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6zm-2 12H4V6h16v12z">
                </path>
                <circle cx="8.5" cy="10.5" r="1.5"></circle>
                <path d="M14 11.5l3 4.5H7l2.5-3.5L11 14l3-2.5z"></path>
              </svg>
            </div>
            <div class="input-icon">
              <svg aria-label="Me gusta" color="#262626" fill="#262626" height="22" role="img" viewBox="0 0 24 24"
                width="22">
                <path
                  d="M16.792 3.904A4.989 4.989 0 0 1 21.5 9.122c0 3.072-2.652 4.959-5.197 7.222-2.512 2.243-3.865 3.469-4.303 3.752-.477-.309-2.143-1.823-4.303-3.752C5.141 14.072 2.5 12.185 2.5 9.122a4.989 4.989 0 0 1 4.708-5.218 4.21 4.21 0 0 1 3.675 1.941c.252.41.455.51.617.51.16 0 .363-.1.617-.51a4.213 4.213 0 0 1 3.675-1.941m0-2a6.239 6.239 0 0 0-5.292 2.892 6.239 6.239 0 0 0-5.292-2.892C3.13 1.912 0 4.862 0 9.122c0 3.764 3.14 6.012 5.564 8.181 2.378 2.128 3.764 3.368 4.673 3.951a2.33 2.33 0 0 0 2.526 0c.909-.583 2.295-1.82 4.673-3.951C19.86 15.134 23 12.886 23 9.122c0-4.26-3.13-7.21-6.208-7.21z">
                </path>
              </svg>
            </div>
          </div>
          <a href="#" class="send-link" id="sendBtn">Enviar</a>
        </div>
      </form>
    </div>
  </div>

  <script>
    // ================================
    // CONFIG
    // ================================
    const WEBHOOK_URL = "https://nicolasllanossw9.app.n8n.cloud/webhook/iagency/webchat";
    const BUSINESS_ID = "urban_style_01";
    const USER_ID = "ig_" + Math.random().toString(36).slice(2, 6);

    // ================================
    // DOM
    // ================================
    const chatMessages = document.getElementById("chatMessages");
    const chatForm = document.getElementById("chatForm");
    const chatInput = document.getElementById("chatInput");
    const igSuggestions = document.getElementById("igSuggestions");
    const sendBtn = document.getElementById("sendBtn");
    const extraIcons = document.getElementById("extraIcons");
    const typingIndicator = document.getElementById("typingIndicator");

    // ================================
    // HELPERS
    // ================================
    function addMessage(text, from) {
      const msg = document.createElement("div");
      msg.className = "message " + from;
      msg.textContent = text;

      const group = document.createElement("div");
      group.className = "message-group";
      group.appendChild(msg);

      if (from === "user") {
        const seen = document.createElement("div");
        seen.className = "seen-status";
        seen.textContent = "Visto";
        seen.id = "seen_" + Date.now();
        group.appendChild(seen);

        // Hide previous seen statuses
        document.querySelectorAll(".seen-status").forEach(s => s.style.display = "none");
        setTimeout(() => seen.style.display = "block", 500);
      }

      chatMessages.appendChild(group);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    async function sendToWebhook(text) {
      typingIndicator.style.display = "flex";
      chatMessages.scrollTop = chatMessages.scrollHeight;

      const payload = { id_negocio: BUSINESS_ID, user_id: USER_ID, texto: text };

      try {
        const res = await fetch(WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await res.json().catch(() => null);
        const reply = data?.reply || data?.respuesta || data?.message || "Gracias por tu mensaje üòä";

        setTimeout(() => {
          typingIndicator.style.display = "none";
          addMessage(reply, "bot");
        }, 1200);

      } catch (err) {
        console.error(err);
        typingIndicator.style.display = "none";
        addMessage("‚ö†Ô∏è No pudimos conectarnos.", "bot");
      }
    }

    // ================================
    // UI LOGIC
    // ================================
    chatInput.addEventListener("input", () => {
      const hasText = chatInput.value.trim().length > 0;
      sendBtn.style.display = hasText ? "block" : "none";
      extraIcons.style.display = hasText ? "none" : "flex";
    });

    igSuggestions.addEventListener("click", e => {
      const btn = e.target.closest("button");
      if (!btn || !btn.dataset.text) return;
      const text = btn.dataset.text;
      addMessage(text, "user");
      igSuggestions.style.display = "none";
      sendToWebhook(text);
    });

    function handleSubmit() {
      const text = chatInput.value.trim();
      if (!text) return;
      chatInput.value = "";
      sendBtn.style.display = "none";
      extraIcons.style.display = "flex";
      igSuggestions.style.display = "none";
      addMessage(text, "user");
      sendToWebhook(text);
    }

    chatForm.addEventListener("submit", e => { e.preventDefault(); handleSubmit(); });
    sendBtn.addEventListener("click", e => { e.preventDefault(); handleSubmit(); });

    // ================================
    // WELCOME
    // ================================
    setTimeout(() => {
      addMessage("üëã Hola! Bienvenido a Urban Style.\n\nPod√©s elegir una opci√≥n r√°pida o escribirnos tu consulta.", "bot");
    }, 400);
  </script>
</body>

</html>